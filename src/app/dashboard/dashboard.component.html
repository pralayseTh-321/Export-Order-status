<!-- Alert Snackbar (Positioned top-center) -->
<div *ngIf="showAlert" class="alert alert-danger alert-dismissible fade show position-fixed"
  style="top: 70px; right: 20px; z-index: 1050; min-width: 250px;" role="alert">
  {{ alertMessage }}
  <button type="button" class="btn-close" (click)="closeAlert()" aria-label="Close"></button>
</div>

<div class="d-flex justify-content-start align-items-end gap-3 mb-4">

  <!-- Searchable Dropdown -->
  <div class="position-relative" style="width: 220px;">
    <label class="form-label fw-semibold">Customer Code</label>
   <input type="text" class="form-control" placeholder="Select customer.."
  [(ngModel)]="searchText"
  (input)="onInputChange()"
  (focus)="isDropdownOpen = true" />

    <div *ngIf="isDropdownOpen && filteredItems.length > 0" class="dropdown-menu show w-100"
      style="max-height: 200px; overflow-y: auto;">
      <button class="dropdown-item" *ngFor="let item of filteredItems" (click)="selectItem(item)">
        {{ item }}
      </button>
    </div>
  </div>


  <!-- From Date -->
  <div>
    <label class="form-label fw-semibold">From</label>
    <input type="date" class="form-control" [(ngModel)]="startDate" [max]="today">
    <div *ngIf="showFromDateError" class="text-danger small mt-1">From date is required.</div>
  </div>

  <!-- To Date -->
  <div>
    <label class="form-label fw-semibold">To</label>
    <input type="date" class="form-control" [(ngModel)]="endDate" [max]="today">
    <div *ngIf="showToDateError" class="text-danger small mt-1">To date is required.</div>
  </div>


  <!-- Search Button -->
  <div>
    <button class="btn btn-primary mt-4" (click)="searchData()">Search</button>
  </div>
</div>
<!-- ðŸ”„ Loader Overlay -->
<div *ngIf="isLoading"
  class="position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center bg-light bg-opacity-75"
  style="z-index: 2000;">
  <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
</div>

<!-- Cards Section -->
<div *ngIf="displayData" class="d-flex flex-wrap gap-3 mb-4">

  <!-- Order Received -->
  <div class="card bg-success text-white flex-grow-1">
    <div class="card-body d-flex align-items-center">
      <i class="fa-solid fa-box-open me-3 fs-3"></i>
      <div class="text-center flex-fill">
        <h6 class="card-subtitle mb-1">Order Received</h6>
        <h4>{{ selectedCustomerData.dispatchCount }}</h4>
      </div>
    </div>
  </div>

  <!-- Orders Created -->
  <div class="card bg-warning text-dark flex-grow-1">
    <div class="card-body d-flex align-items-center">
      <i class="fa-solid fa-pen-square me-3 fs-3"></i>
      <div class="text-center flex-fill">
        <h6 class="card-subtitle mb-1">Orders Created</h6>
        <h4>{{ selectedCustomerData.pendingCount }}</h4>
      </div>
    </div>
  </div>

  <!-- Not Reflect -->
  <div class="card bg-danger text-white flex-grow-1" (click)="toggleAccordion()">
    <div class="card-body d-flex align-items-center">
      <i class="fa-solid fa-triangle-exclamation me-3 fs-3"></i>
      <div class="text-center flex-fill">
        <h6 class="card-subtitle mb-1">Not Reflect</h6>
        <h4>
          <a href="javascript:void(0)" class="text-white fw-bold cancel-link" (click)="onCancelCountClick($event)">
            {{ selectedCustomerData.cancelCount }}
          </a>
        </h4>
      </div>
    </div>
  </div>

</div>




<!-- Accordion Table Section -->
<div *ngIf="showAccordion" class="mt-4">
  <div class="accordion" id="orderAccordion">
    <div class="accordion-item">
      <h2 class="accordion-header bg-light" id="headingOne">
  <div class="d-flex align-items-center justify-content-between w-100">
    <!-- Accordion Toggle Button -->
    <button class="accordion-button collapsed flex-grow-1 d-flex align-items-center gap-2"
            type="button"
            (click)="toggleExpandAccordion()"
            [attr.aria-expanded]="accordionExpanded">

      <!-- Left content -->
      <span class="fw-bold">Order Status</span>
      <span *ngIf="sampleOrderData.length > 0" class="badge bg-primary">
        {{ sampleOrderData.length }}
      </span>
    </button>

    <!-- Download Icon Button (Beside arrow) -->
    <button class="btn btn-sm btn-outline-primary ms-2 me-3"
            (click)="downloadCSV(); $event.stopPropagation()"
            title="Download CSV">
      <i class="fa-solid fa-file-csv"></i>
    </button>
  </div>
</h2>


      <div class="accordion-collapse" [ngClass]="{ 'collapse': true, 'show': accordionExpanded }">
        <div class="accordion-body p-0">
          <div style="max-height: 350px; overflow-y: auto;">
            <table class="table table-bordered table-hover m-0">
              <thead>
                <tr>
                  <th class="sticky-th bg-white d-flex align-items-center justify-content-between">
                    <span>Order No</span>
                    <div class="d-flex align-items-center">
                      <label class="mb-0">Date:</label>
                      <select class="form-select form-select-sm ms-1" style="width: auto;"
                        [(ngModel)]="selectedEntryDate" (change)="applyDateFilter()">
                        <option value="" disabled selected>Select Date</option>
                        <option *ngFor="let date of uniqueEntryDates" [value]="date">{{ date }}</option>
                      </select>
                    </div>
                  </th>

                  <th class="sticky-th">Status</th>
                  <th class="sticky-th">Entry Date</th> <!-- New Column -->
                    <!-- <th class="sticky-th">XML</th> -->
                </tr>
              </thead>

              <tbody>
                <tr *ngFor="let order of sampleOrderData">
                  <td>{{ order.orderNo }}</td>
                  <td>
                    <span class="badge me-1" [ngClass]="getStatusBadgeClass(order.statusCode)">
                      {{ order.statusDesc || 'Unknown Status' }}
                    </span>
                  </td>
                  <td>{{ order.entryDate }}</td> <!-- New Cell -->
                  <!-- <td class="text-start"> 
                    <div class="d-flex align-items-center gap-2">
                      
                      <button class="btn btn-sm btn-outline-primary"
                        (click)="downloadXmlRow(order); $event.stopPropagation()"
                        [disabled]="downloadingXmlRows.has(order.orderNo)" title="Download XML">
                        <ng-container *ngIf="!downloadingXmlRows.has(order.orderNo); else spinning">
                          <i class="bi bi-filetype-xml"></i>
                        </ng-container>
                        <ng-template #spinning>
                          <div class="spinner-border spinner-border-sm text-secondary" role="status">
                            <span class="visually-hidden">Loadingâ€¦</span>
                          </div>
                        </ng-template>
                      </button>

                    
                    </div>
                  </td> -->
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>